<!DOCTYPE html>
<html>
<head>
    <title>DOCX上传测试</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>DOCX上传测试</h1>
    <input type="file" id="fileInput" accept=".docx" />
    <div id="result" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc;"></div>
    
    <script>
        // 简单的测试函数模拟canParse
        function canParse(file) {
            const supportedTypes = ['txt', 'md', 'docx', 'pdf'];
            const fileType = file.name.split('.').pop()?.toLowerCase();
            console.log('文件类型:', fileType);
            console.log('支持的类型:', supportedTypes);
            console.log('是否支持:', supportedTypes.includes(fileType || ''));
            return supportedTypes.includes(fileType || '');
        }

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const resultDiv = document.getElementById('result');
            
            if (!file) {
                resultDiv.innerHTML = '<span style="color: red;">没有选择文件</span>';
                return;
            }

            console.log('选择的文件:', file.name, file.size, file.type);
            
            // 测试文件类型支持
            const isSupported = canParse(file);
            
            if (isSupported) {
                resultDiv.innerHTML = `
                    <div style="color: green;">
                        <strong>✅ 文件格式支持</strong><br>
                        文件名: ${file.name}<br>
                        文件大小: ${(file.size / 1024).toFixed(2)} KB<br>
                        文件类型: ${file.type || '未知'}<br>
                        状态: 可以上传处理
                    </div>
                `;
                
                // 如果是TXT文件，尝试读取内容
                if (file.name.toLowerCase().endsWith('.txt')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const text = e.target.result;
                        resultDiv.innerHTML += `<br><strong>文件内容预览:</strong><br><pre style="background: #f5f5f5; padding: 10px; max-height: 200px; overflow-y: auto;">${text.substring(0, 500)}...</pre>`;
                    };
                    reader.readAsText(file);
                }
            } else {
                resultDiv.innerHTML = `
                    <div style="color: red;">
                        <strong>❌ 不支持的文件格式</strong><br>
                        文件名: ${file.name}<br>
                        请使用: PDF, DOCX, TXT, MD 格式
                    </div>
                `;
            }
        });
        
        console.log('DOCX测试页面已加载');
    </script>
</body>
</html>