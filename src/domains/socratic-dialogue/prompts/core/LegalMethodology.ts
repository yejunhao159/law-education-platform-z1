/**
 * 法学方法论完整体系
 *
 * 【重要说明】12种方法的定位：
 * - 这些是法学分析的"基本工具"，不是让学生直接选择的"分析框架"
 * - 在Structure阶段，推荐的是"分析框架"（多种方法的组合），见LegalEducationSocratic.ts
 * - 12种方法会在Socratic探索阶段被自然使用，无需刻意提及方法名称
 *
 * 【分类体系】：
 * 1. 法律解释方法（6种）- 明确法律规范的含义
 *    Savigny四大方法：文义、体系、历史、目的
 *    现代补充：比较法解释、宪法解释
 *
 * 2. 法律推理方法（3种）- 从法律规范推导出结论
 *    演绎推理（三段论）、归纳推理、类比推理
 *
 * 3. 法律论证方法（3种）- 论证结论的正当性
 *    要件分析、利益衡量、原则适用
 *
 * 【适用顺序】（解释方法的一般优先级）：
 * 文义解释(1) → 体系解释(2) → 目的解释(3) → 历史解释(4) → 比较法(5) → 宪法(6)
 *
 * 【注意】：
 * - 优先级不是严格顺序，实际中常需多种方法结合使用
 * - 文义明确时，无需其他方法；文义不明时，多种方法并用
 */

export interface LegalMethod {
  name: string;
  englishName: string;
  essence: string;
  steps: string[];
  适用场景: string;
  example: string;
  priority: number; // 1-10，数字越小优先级越高
}

/**
 * 一、法律解释方法（6种）
 * 核心目标：明确法律规范的含义
 */
export const LEGAL_INTERPRETATION_METHODS: Record<string, LegalMethod> = {

  /** 1. 文义解释 - 起点和基石 */
  literal: {
    name: "文义解释（字面解释）",
    englishName: "Literal/Textual Interpretation",
    essence: "根据法律条文的字面含义和通常语义理解法律",
    steps: [
      "第一步：找到适用的法条原文",
      "第二步：分析法条的字面含义",
      "  - 专业术语：按法律定义理解",
      "  - 日常用语：按通常语义理解",
      "第三步：确定法条的语义范围"
    ],
    适用场景: "法条文义清晰明确时优先使用",
    example: `
法条："不履行合同义务"
文义解释：
- "不履行"：完全不做
- 语义范围：完全不履行 + 不适当履行
结论：拒绝过户属于"不履行"的范畴
    `,
    priority: 1
  },

  /** 2. 体系解释 - 广泛适用 */
  systematic: {
    name: "体系解释（系统解释）",
    englishName: "Systematic Interpretation",
    essence: "将法条放在整部法律乃至整个法律体系中理解",
    steps: [
      "第一步：找到相关法条所在的章节和体系位置",
      "第二步：分析同一章节的其他法条",
      "第三步：分析上下位法条的关系",
      "第四步：在整个法律体系中确定法条含义"
    ],
    适用场景: "法条文义不清，需要结合其他法条理解",
    example: `
问题：民法典577条的"违约责任"包括什么？
体系解释：
- 577条位于"违约责任"一章
- 同章579条规定"继续履行"
- 同章584条规定"赔偿损失"
结论："违约责任"包括继续履行、赔偿损失等多种形式
    `,
    priority: 2
  },

  /** 3. 目的解释 - 核心方法 */
  purposive: {
    name: "目的解释（立法目的解释）",
    englishName: "Purposive/Teleological Interpretation",
    essence: "从法条的立法目的和价值取向理解法律",
    steps: [
      "第一步：识别法条的立法目的",
      "  - 主观目的：立法者的意图（历史文献）",
      "  - 客观目的：法条的社会功能（当前需求）",
      "第二步：分析本案事实是否符合立法目的",
      "第三步：根据立法目的确定法条适用范围"
    ],
    适用场景: "法条文义不清或存在多种理解可能时",
    example: `
法条：显失公平制度（民法典151条）
立法目的：
- 保护交易中的弱者（主观目的）
- 维护实质公平（客观目的）
- 不是保护所有事后后悔的人

本案分析：
- 甲方确实处于信息劣势 ✓
- 不是简单的价格后悔 ✓
结论：符合立法目的，应适用
    `,
    priority: 3
  },

  /** 4. 历史解释 - 辅助方法 */
  historical: {
    name: "历史解释（沿革解释）",
    englishName: "Historical Interpretation",
    essence: "通过法律的制定过程和历史背景理解法律",
    steps: [
      "第一步：查找立法资料",
      "  - 立法说明、草案说明",
      "  - 修订前后对比",
      "  - 立法辩论记录",
      "第二步：分析法条的立法背景和社会需求",
      "第三步：根据历史材料确定法条本意"
    ],
    适用场景: "法条文义和目的均不清楚，需要追溯立法本意",
    example: `
法条：情势变更制度（民法典533条）
历史解释：
- 1999年合同法未明确规定
- 2009年合同法司法解释(二)第26条首次规定
- 2020年民法典正式纳入
- 立法说明：应对不可预见的重大变化

本案分析：
- 房价波动是市场常态（可预见）
- 不符合"不可预见的重大变化"
结论：不适用情势变更
    `,
    priority: 4
  },

  /** 5. 比较法解释 - 参考方法 */
  comparative: {
    name: "比较法解释",
    englishName: "Comparative Law Interpretation",
    essence: "参考其他法域的类似规定理解本国法律",
    steps: [
      "第一步：找到其他法域的类似规定",
      "  - 大陆法系国家（德国、法国、日本）",
      "  - 国际条约、示范法",
      "第二步：分析相似点和不同点",
      "第三步：参考借鉴，但不照搬"
    ],
    适用场景: "中国法律规定不明确，可参考国外立法例",
    example: `
问题：惩罚性赔偿的适用范围
比较法参考：
- 德国法：一般不认可惩罚性赔偿
- 美国法：广泛适用惩罚性赔偿
- 中国选择：有限承认（消费者保护、知识产权）

结论：中国法采折中立场，不能照搬美国或德国
    `,
    priority: 5
  },

  /** 6. 宪法解释 - 合宪性审查 */
  constitutional: {
    name: "宪法解释（合宪性解释）",
    englishName: "Constitutional Interpretation",
    essence: "确保法律解释符合宪法的基本价值",
    steps: [
      "第一步：识别涉及的宪法基本权利或原则",
      "第二步：检验法律解释是否违反宪法",
      "第三步：在多种解释中选择符合宪法的解释"
    ],
    适用场景: "法律解释可能涉及基本权利冲突时",
    example: `
问题：合同自由 vs 公平正义
宪法层面：
- 宪法保护私有财产权（合同自由）
- 宪法强调社会主义公平正义

合宪性解释：
- 合同自由不是绝对的
- 必须以不违反公平为前提
结论：在极端不公平时可以干预合同
    `,
    priority: 6
  }
};

/**
 * 二、法律推理方法（3种）
 * 核心目标：从法律规范推导出案件结论
 */
export const LEGAL_REASONING_METHODS: Record<string, LegalMethod> = {

  /** 1. 演绎推理（三段论）- 主要方法 */
  deduction: {
    name: "演绎推理（三段论）",
    englishName: "Deductive Reasoning / Syllogism",
    essence: "从一般法律规范推导出具体案件结论",
    steps: [
      "第一步：确定大前提（法律规范）",
      "  - 找到适用的法条",
      "  - 理解法条的构成要件和法律效果",
      "",
      "第二步：确定小前提（案件事实）",
      "  - 查明案件事实",
      "  - 判断事实是否符合法条的构成要件",
      "",
      "第三步：得出结论（法律效果）",
      "  - 三段论推导：大前提 + 小前提 → 结论"
    ],
    适用场景: "法律关系清晰，主要是法条适用问题",
    example: `
大前提：《民法典》577条规定，不履行合同义务应承担违约责任
小前提：被告收款后拒绝过户，构成不履行合同义务
结论：被告应承担继续履行的违约责任
    `,
    priority: 1
  },

  /** 2. 归纳推理 - 辅助方法 */
  induction: {
    name: "归纳推理",
    englishName: "Inductive Reasoning",
    essence: "从多个具体案件总结出一般规则",
    steps: [
      "第一步：收集多个相似案件",
      "第二步：分析案件的共同特征",
      "第三步：归纳出一般性规则",
      "第四步：将规则应用到新案件"
    ],
    适用场景: "法律规定不明确，需要从判例中归纳规则",
    example: `
案例1：房价涨价拒绝过户 → 判决继续履行
案例2：股票涨价拒绝交付 → 判决继续履行
案例3：古董涨价拒绝交付 → 判决继续履行

归纳规则：标的物涨价不构成免责事由
应用到本案：被告以房价上涨拒绝履行 → 不能免责
    `,
    priority: 2
  },

  /** 3. 类比推理 - 判例参照 */
  analogy: {
    name: "类比推理（类比适用）",
    englishName: "Analogical Reasoning",
    essence: "从相似案件推导出本案的处理规则",
    steps: [
      "第一步：找到相似案件（指导性案例、类似判例）",
      "第二步：分析相似点和不同点",
      "第三步：判断相似点是否具有决定性",
      "第四步：推导出本案的处理规则"
    ],
    适用场景: "法律规定不明确，但有类似判例可参考",
    example: `
本案（房屋买卖）vs 指导案例X号（汽车买卖）：

相似点：
✓ 都是买卖合同
✓ 都是卖方拒绝交付
✓ 都是因标的物涨价

不同点：
✗ 标的物不同（房屋 vs 汽车）

判断：标的物的差异不影响违约责任的认定

结论：参照指导案例，判决卖方继续履行
    `,
    priority: 3
  }
};

/**
 * 三、法律论证方法（3种）
 * 核心目标：为法律结论提供正当性论证
 */
export const LEGAL_ARGUMENTATION_METHODS: Record<string, LegalMethod> = {

  /** 1. 构成要件分析法 */
  elementAnalysis: {
    name: "构成要件分析法",
    englishName: "Element Analysis Method",
    essence: "逐一检验法条规定的所有构成要件是否满足",
    steps: [
      "第一步：列出法条的所有构成要件",
      "第二步：逐一检验每个要件是否满足",
      "  - 满足：打✓",
      "  - 不满足：打✗",
      "  - 不确定：需要进一步分析",
      "第三步：综合判断",
      "  - 所有要件满足 → 法律效果成立",
      "  - 任一要件不满足 → 法律效果不成立"
    ],
    适用场景: "法条有多个构成要件，需要逐一检验",
    example: `
显失公平（民法典第151条）的三要件：

要件1：给付与对价严重失衡
✓ 本案：50万 vs 5万，明显失衡

要件2：一方处于不利地位
✓ 本案：甲方信息不对称

要件3：对方利用了这种不利地位
✓ 本案：乙方明知甲方不了解市场价

结论：三要件全部满足，可以行使撤销权
    `,
    priority: 1
  },

  /** 2. 利益衡量法 */
  interestBalancing: {
    name: "利益衡量法",
    englishName: "Interest Balancing Method",
    essence: "在冲突的利益之间寻找平衡点",
    steps: [
      "第一步：识别冲突的利益",
      "  - 原告的利益诉求",
      "  - 被告的利益诉求",
      "  - 社会公共利益",
      "",
      "第二步：评估各方利益的正当性和重要性",
      "  - 合法性：是否受法律保护",
      "  - 紧迫性：哪方损失更大",
      "  - 公共性：是否影响社会秩序",
      "",
      "第三步：寻找平衡点",
      "  - 法律明确规定的优先顺序",
      "  - 立法目的和价值取向",
      "  - 社会效果和公平正义"
    ],
    适用场景: "法律规定不明确，存在价值冲突",
    example: `
合同自由 vs 公平正义：

利益识别：
- 被告利益：合同自由，可以不履行
- 原告利益：公平正义，应当履行
- 社会利益：维护交易安全

利益评估：
- 被告利益：合同自由不是绝对的
- 原告利益：已履行义务，受损失
- 社会利益：需要维护诚信

平衡点：
- 合同自由以不违反公平为前提
- 公平正义优先于单方自由

结论：判决被告履行
    `,
    priority: 2
  },

  /** 3. 法律原则适用法 */
  principleBased: {
    name: "法律原则适用法",
    englishName: "Legal Principle Application",
    essence: "当具体规则不明确时，适用法律原则解决问题",
    steps: [
      "第一步：识别适用的法律原则",
      "  - 诚实信用原则",
      "  - 公平原则",
      "  - 禁止权利滥用原则",
      "",
      "第二步：分析本案是否违反法律原则",
      "",
      "第三步：根据法律原则作出判断"
    ],
    适用场景: "具体法律规则不明确或存在漏洞",
    example: `
问题：合同没有约定违约金，如何赔偿？

具体规则：法律未明确规定计算方法

法律原则适用：
- 诚实信用原则：违约方应诚信赔偿
- 公平原则：赔偿应与损失相当
- 填补损害原则：使守约方恢复到合同履行状态

结论：按实际损失赔偿（包括直接损失和可得利益损失）
    `,
    priority: 3
  }
};

/**
 * 方法论的适用顺序建议
 */
export const METHODOLOGY_APPLICATION_ORDER = {
  解释方法顺序: [
    "1. 文义解释（起点）- 先看法条字面含义",
    "2. 体系解释（常用）- 结合其他法条理解",
    "3. 目的解释（核心）- 从立法目的理解",
    "4. 历史解释（辅助）- 追溯立法本意",
    "5. 比较法解释（参考）- 借鉴国外立法",
    "6. 宪法解释（合宪性审查）- 确保符合宪法"
  ],

  推理方法顺序: [
    "1. 演绎推理（主要）- 法条清晰时用三段论",
    "2. 归纳推理（辅助）- 从多个案例总结规则",
    "3. 类比推理（参照）- 参考指导性案例"
  ],

  论证方法选择: [
    "1. 构成要件分析（法条有明确要件）",
    "2. 利益衡量（存在价值冲突）",
    "3. 法律原则适用（规则不明确或有漏洞）"
  ]
};

/**
 * 生成完整的法学方法论Prompt
 */
export function getLegalMethodologyPrompt(): string {
  return `# ⚖️ 法学方法论完整体系

## 🎯 重要说明：方法 vs 框架

**12种方法 ≠ 让学生选择的选项**
- 这些方法是**你的工具箱**，不是直接呈现给学生的选择题
- 在Structure阶段，你推荐的是"分析框架"（见M4），而不是单一方法
- 在Socratic探索阶段，你会**自然地使用**这些方法，但无需告诉学生"我现在用的是XX解释方法"

**正确的使用方式**：
✅ 好："我们看看这个法条在整部民法典中的位置..."（体系解释，但不说出来）
❌ 差："现在我们用体系解释方法分析..."（太学术，学生困惑）

---

## 一、法律解释方法（6种）

核心目标：明确法律规范的含义

**适用顺序**（一般规则）：
${METHODOLOGY_APPLICATION_ORDER.解释方法顺序.join('\n')}

---

${Object.values(LEGAL_INTERPRETATION_METHODS).sort((a, b) => a.priority - b.priority).map(method => `
### ${method.name}

**本质**：${method.essence}

**方法步骤**：
${method.steps.join('\n')}

**适用场景**：${method.适用场景}

**示例**：
\`\`\`${method.example}\`\`\`

---
`).join('\n')}

## 二、法律推理方法（3种）

核心目标：从法律规范推导出案件结论

**适用顺序**：
${METHODOLOGY_APPLICATION_ORDER.推理方法顺序.join('\n')}

---

${Object.values(LEGAL_REASONING_METHODS).sort((a, b) => a.priority - b.priority).map(method => `
### ${method.name}

**本质**：${method.essence}

**方法步骤**：
${method.steps.join('\n')}

**适用场景**：${method.适用场景}

**示例**：
\`\`\`${method.example}\`\`\`

---
`).join('\n')}

## 三、法律论证方法（3种）

核心目标：为法律结论提供正当性论证

**方法选择**：
${METHODOLOGY_APPLICATION_ORDER.论证方法选择.join('\n')}

---

${Object.values(LEGAL_ARGUMENTATION_METHODS).sort((a, b) => a.priority - b.priority).map(method => `
### ${method.name}

**本质**：${method.essence}

**方法步骤**：
${method.steps.join('\n')}

**适用场景**：${method.适用场景}

**示例**：
\`\`\`${method.example}\`\`\`

---
`).join('\n')}

## 🎯 方法论综合运用

在实际案件分析中，通常需要综合运用多种方法：

1. **先解释，后推理，再论证**
   - 第一步：用解释方法明确法条含义
   - 第二步：用推理方法推导结论
   - 第三步：用论证方法证成结论

2. **多种解释方法结合使用**
   - 文义解释（基础）+ 体系解释（补充）+ 目的解释（核心）

3. **推理与论证相互支撑**
   - 演绎推理提供逻辑框架
   - 要件分析提供具体论证
   - 利益衡量解决价值冲突

**记住**：方法论是工具，不是目的。
目标是得出公正、合理、符合法律的结论，而不是机械套用方法。
`;
}
