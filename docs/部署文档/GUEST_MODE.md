# 🎭 游客模式（Guest Mode）使用说明

## 📋 什么是游客模式？

游客模式是一个**临时调试功能**，用于快速验证系统核心功能，无需登录即可访问所有页面。

## 🎯 为什么需要游客模式？

### 矛盾论分析

**当前问题**：
- 主要矛盾：登录功能有bug → 整个系统不可用
- 次要矛盾：AI教学、Socket.IO等核心功能可能正常，但无法验证

**解决思路**：
- 暂时移除登录验证 → 快速验证核心功能
- 符合敏捷开发：先让系统跑起来，再完善辅助功能
- 符合奥卡姆剃刀：如无必要，勿增实体

## 🔧 如何启用/禁用游客模式？

### 方式1：环境变量（推荐）

```bash
# Docker运行时设置
docker run -e GUEST_MODE=true ...

# 或在.env文件中设置
GUEST_MODE=true
```

### 方式2：Dockerfile

```dockerfile
# 默认启用（当前配置）
ENV GUEST_MODE=true

# 禁用游客模式
ENV GUEST_MODE=false
```

### 方式3：代码中修改（开发环境）

```typescript
// middleware.ts
const GUEST_MODE = true;  // 直接改成true或false
```

## 📊 游客模式 vs 正常模式

| 特性 | 游客模式 | 正常模式 |
|------|---------|---------|
| 登录验证 | ❌ 跳过 | ✅ 必须 |
| 用户隔离 | ❌ 无 | ✅ 有 |
| 权限管理 | ❌ 无 | ✅ 有 |
| 核心功能 | ✅ 可用 | ✅ 可用 |
| 适用场景 | 开发/调试 | 生产环境 |

## ✅ 游客模式启用后的效果

1. **所有页面直接访问**
   - 不会重定向到登录页
   - 不验证token
   - 不检查权限

2. **核心功能正常**
   - AI教学功能可用
   - Socket.IO实时通讯可用
   - PPT生成功能可用

3. **日志提示**
   ```
   🎭 [GUEST MODE] 游客模式已启用，跳过登录验证: /
   ```

## 🚀 快速测试步骤

### Step 1: 构建镜像（游客模式）

```bash
docker build -t law-edu-platform:guest-mode \
  --build-arg DEEPSEEK_API_KEY=your-key \
  --build-arg NEXT_PUBLIC_AI_302_API_KEY=your-key \
  .
```

### Step 2: 运行容器

```bash
docker run -d --name law-edu-guest \
  -p 3000:3000 -p 3001:3001 \
  -e GUEST_MODE=true \
  law-edu-platform:guest-mode
```

### Step 3: 访问系统

```bash
# 直接打开浏览器
open http://localhost:3000

# 或测试API
curl http://localhost:3000/api/health
```

**期望效果**：
- ✅ 不会重定向到/login
- ✅ 可以直接访问所有页面
- ✅ AI功能可以正常使用

## 🔍 验证核心功能清单

### 1. AI教学功能
- [ ] 访问 http://localhost:3000
- [ ] 测试AI对话功能
- [ ] 测试苏格拉底式提问

### 2. Socket.IO实时功能
- [ ] 访问课堂页面
- [ ] 测试教师发布问题
- [ ] 测试学生提交答案

### 3. PPT生成功能
- [ ] 测试PPT大纲生成（如果已实现API）
- [ ] 验证API密钥是否正确传递

### 4. 其他功能
- [ ] 证据质量评估
- [ ] 时间线分析
- [ ] 争议焦点分析

## ⚠️ 重要提醒

### 安全性

**游客模式仅用于开发和调试！**

- ❌ **不要在生产环境启用游客模式**
- ❌ **不要将GUEST_MODE=true的镜像推送到生产**
- ✅ 仅在本地测试或安全的内网环境使用

### 何时禁用游客模式？

当以下情况之一出现时，应该禁用游客模式：

1. ✅ 核心功能验证完成
2. ✅ 登录功能修复完成
3. ✅ 准备上线生产环境
4. ✅ 需要多用户隔离

### 如何禁用？

```bash
# 方式1：运行时禁用
docker run -e GUEST_MODE=false ...

# 方式2：修改Dockerfile
ENV GUEST_MODE=false

# 方式3：删除环境变量（默认false）
```

## 📈 下一步计划

### 当前阶段（游客模式）

1. ✅ 验证AI教学功能
2. ✅ 验证Socket.IO实时通讯
3. ✅ 验证PPT生成功能
4. ✅ 发现并修复核心功能的bug

### 后续阶段（恢复登录）

1. 🔧 修复数据库依赖问题
2. 🔧 修复better-sqlite3编译
3. 🔧 验证登录功能正常
4. 🔧 禁用游客模式，启用完整认证

## 🎯 矛盾转化

**当前主要矛盾**：
- 验证系统核心功能是否正常（AI教学、Socket.IO）

**游客模式解决后的新矛盾**：
- 如果核心功能正常 → 可以考虑修复登录
- 如果核心功能有问题 → 先修复核心功能，再考虑登录

**螺旋上升**：
1. 游客模式 → 验证核心功能
2. 修复核心bug → 系统稳定
3. 修复登录 → 完整功能
4. 上线生产 → 服务用户

---

## 💡 核心理念

> 符合敏捷开发：先让系统跑起来，再完善功能
> 符合矛盾论：抓主要矛盾（核心功能），放次要矛盾（登录）
> 符合奥卡姆剃刀：暂时不需要的就先去掉

**让系统快速可用，才是第一优先级！**

---

**创建时间**: 2025-10-18
**作者**: Sean (PromptX)
**版本**: v1.0 - Guest Mode
