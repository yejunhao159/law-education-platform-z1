# E2Eæµ‹è¯•æ‰§è¡ŒæŒ‡å—

## ä»»åŠ¡åˆ†å·¥

### ğŸ‘¤ å¼€å‘è€…Aï¼šå››å¹•æ•™å­¦æ³•æµç¨‹æµ‹è¯•
**æ–‡ä»¶**ï¼š`four-acts-flow.spec.ts`
**ç›®æ ‡**ï¼šéªŒè¯ç”¨æˆ·èƒ½å®Œæ•´èµ°å®Œå››å¹•æ•™å­¦æµç¨‹

### ğŸ‘¤ å¼€å‘è€…Bï¼šAIé”™è¯¯å¤„ç†æµ‹è¯•
**æ–‡ä»¶**ï¼š`ai-error-handling.spec.ts`
**ç›®æ ‡**ï¼šéªŒè¯ç³»ç»Ÿåœ¨AIæœåŠ¡å¤±è´¥æ—¶çš„å®¹é”™èƒ½åŠ›

---

## å¼€å‘è€…Aï¼šæ‰§è¡Œæ­¥éª¤

### 1. å‡†å¤‡æµ‹è¯•æ•°æ®ï¼ˆ15åˆ†é’Ÿï¼‰

```bash
# åˆ›å»ºfixturesç›®å½•ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
mkdir -p tests/fixtures

# ä¸‹è½½ä¸€ä¸ªçœŸå®åˆ¤å†³ä¹¦å¹¶è½¬æ¢ä¸ºWordæ ¼å¼
# æ–¹å¼1ï¼šä»è£åˆ¤æ–‡ä¹¦ç½‘ä¸‹è½½
# è®¿é—®ï¼šhttps://wenshu.court.gov.cn/
# æœç´¢"ä¹°å–åˆåŒçº çº·"ï¼Œä¸‹è½½ä¸€ä¸ªç®€å•æ¡ˆä¾‹
# è½¬æ¢ä¸º .docx æ ¼å¼

# æ–¹å¼2ï¼šå¦‚æœé¡¹ç›®å·²æœ‰æµ‹è¯•æ¡ˆä¾‹ï¼Œç›´æ¥å¤åˆ¶
# cp /path/to/existing/case.docx tests/fixtures/test-judgment.docx

# éªŒè¯æ–‡ä»¶å­˜åœ¨
ls -lh tests/fixtures/test-judgment.docx
```

### 2. è°ƒæ•´æµ‹è¯•ä»£ç ä¸­çš„é€‰æ‹©å™¨ï¼ˆé‡è¦ï¼ï¼‰

æµ‹è¯•ä¸­ä½¿ç”¨çš„é€‰æ‹©å™¨ï¼ˆå¦‚ `data-testid`ï¼‰éœ€è¦æ ¹æ®å®é™…ç»„ä»¶è°ƒæ•´ï¼š

```typescript
// ç¤ºä¾‹ï¼šå¦‚æœä½ çš„è¾“å…¥æ¡†ä¸æ˜¯ data-testid="student-input"
// è€Œæ˜¯ id="chat-input"ï¼Œéœ€è¦ä¿®æ”¹ä¸ºï¼š
await page.locator('#chat-input').fill('...');

// æˆ–è€…ä½¿ç”¨æ–‡æœ¬é€‰æ‹©å™¨
await page.locator('textarea[placeholder="è¾“å…¥æ‚¨çš„å›ç­”"]').fill('...');
```

**éœ€è¦æ£€æŸ¥çš„å…³é”®é€‰æ‹©å™¨**ï¼š
- `[data-testid="extraction-result"]` â†’ åˆ¤å†³ä¹¦æå–ç»“æœå®¹å™¨
- `[data-testid="fact-analysis"]` â†’ äº‹å®åˆ†æç»“æœ
- `[data-testid="chat-container"]` â†’ å¯¹è¯å®¹å™¨
- `[data-testid="student-input"]` â†’ å­¦ç”Ÿè¾“å…¥æ¡†
- `[data-testid="ai-message"]` â†’ AIæ¶ˆæ¯

**å¦‚ä½•æ‰¾åˆ°æ­£ç¡®çš„é€‰æ‹©å™¨**ï¼š
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯å¯åŠ¨Playwright UIæ¨¡å¼
npx playwright test --ui

# ä½¿ç”¨Pick LocatoråŠŸèƒ½ç‚¹å‡»å…ƒç´ ï¼Œè‡ªåŠ¨ç”Ÿæˆé€‰æ‹©å™¨
```

### 3. è¿è¡Œæµ‹è¯•

```bash
# æ–¹å¼1ï¼šè¿è¡Œæ‰€æœ‰æµ‹è¯•
npx playwright test tests/e2e/critical-paths/four-acts-flow.spec.ts

# æ–¹å¼2ï¼šä½¿ç”¨UIæ¨¡å¼ï¼ˆæ¨èï¼Œå¯ä»¥çœ‹åˆ°æ‰§è¡Œè¿‡ç¨‹ï¼‰
npx playwright test tests/e2e/critical-paths/four-acts-flow.spec.ts --ui

# æ–¹å¼3ï¼šè°ƒè¯•æ¨¡å¼ï¼ˆé€æ­¥æ‰§è¡Œï¼‰
npx playwright test tests/e2e/critical-paths/four-acts-flow.spec.ts --debug

# æ–¹å¼4ï¼šheadedæ¨¡å¼ï¼ˆçœ‹åˆ°æµè§ˆå™¨ç•Œé¢ï¼‰
npx playwright test tests/e2e/critical-paths/four-acts-flow.spec.ts --headed
```

### 4. è°ƒè¯•å¸¸è§é—®é¢˜

#### é—®é¢˜1ï¼šæ‰¾ä¸åˆ°å…ƒç´ 
```
Error: locator.click: Timeout 30000ms exceeded.
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥é€‰æ‹©å™¨æ˜¯å¦æ­£ç¡®
2. å¢åŠ ç­‰å¾…æ—¶é—´ï¼š`{ timeout: 60000 }`
3. ä½¿ç”¨ `--headed` æ¨¡å¼çœ‹å®é™…é¡µé¢

#### é—®é¢˜2ï¼šAIè°ƒç”¨è¶…æ—¶
```
Error: Test timeout of 120000ms exceeded.
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å¢åŠ æµ‹è¯•è¶…æ—¶ï¼š`test.setTimeout(180000);`
2. æ£€æŸ¥ DeepSeek API key æ˜¯å¦é…ç½®æ­£ç¡®
3. æ£€æŸ¥ç½‘ç»œè¿æ¥

#### é—®é¢˜3ï¼šè·¯ç”±ä¸åŒ¹é…
```
Error: expect(page).toHaveURL(/.*act-one/)
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥å®é™…è·¯ç”±æ˜¯ä»€ä¹ˆï¼š`console.log(await page.url())`
2. ä¿®æ”¹æµ‹è¯•ä¸­çš„è·¯ç”±åŒ¹é…è§„åˆ™

### 5. éªŒæ”¶æ ‡å‡†

âœ… **é€šè¿‡æ ‡å‡†**ï¼š
- æ‰€æœ‰æµ‹è¯•æ­¥éª¤å…¨éƒ¨é€šè¿‡ï¼ˆç»¿è‰²ï¼‰
- ä»ç¬¬ä¸€å¹•åˆ°ç¬¬å››å¹•æµç¨‹å®Œæ•´
- æœ€ç»ˆèƒ½å¯¼å‡ºæŠ¥å‘Š

âŒ **å¤±è´¥å¤„ç†**ï¼š
- æˆªå›¾ä¿å­˜åœ¨ `test-results/` ç›®å½•
- æŸ¥çœ‹å¤±è´¥çš„æ­¥éª¤ï¼Œè°ƒæ•´ä»£ç æˆ–æµ‹è¯•
- ä¿®å¤åé‡æ–°è¿è¡Œ

---

## å¼€å‘è€…Bï¼šæ‰§è¡Œæ­¥éª¤

### 1. ç†è§£æµ‹è¯•åœºæ™¯

ä½ çš„ä»»åŠ¡æ˜¯éªŒè¯ç³»ç»Ÿåœ¨å„ç§AIæœåŠ¡å¤±è´¥åœºæ™¯ä¸‹çš„è¡¨ç°ï¼š
- APIè¶…æ—¶
- APIè¿”å›é”™è¯¯
- ç½‘ç»œæ–­å¼€
- è¿”å›ç©ºç»“æœ
- è¿ç»­å¤±è´¥ï¼ˆç†”æ–­å™¨ï¼‰

### 2. ä¸éœ€è¦å‡†å¤‡æµ‹è¯•æ•°æ®

è¿™äº›æµ‹è¯•ä½¿ç”¨**Mockï¼ˆæ¨¡æ‹Ÿï¼‰**çš„æ–¹å¼ï¼Œä¸éœ€è¦çœŸå®æ–‡æ¡£ã€‚

### 3. è°ƒæ•´Mockç­–ç•¥

æµ‹è¯•ä¸­ä½¿ç”¨äº† `context.route()` æ¥æ‹¦æˆªAPIè¯·æ±‚ï¼š

```typescript
// ç¤ºä¾‹ï¼šæ‹¦æˆªè‹æ ¼æ‹‰åº•å¯¹è¯API
await context.route('**/api/socratic/**', async (route) => {
  // æ¨¡æ‹Ÿè¶…æ—¶
  route.abort('timedout');
});
```

**éœ€è¦æ ¹æ®å®é™…APIè·¯ç”±è°ƒæ•´**ï¼š
```bash
# æŸ¥çœ‹é¡¹ç›®çš„APIè·¯ç”±
ls -R app/api/

# æ‰¾åˆ°è‹æ ¼æ‹‰åº•å¯¹è¯ç›¸å…³çš„API
# ä¾‹å¦‚ï¼šapp/api/socratic/route.ts
# é‚£ä¹ˆæ‹¦æˆªè·¯å¾„å°±æ˜¯ï¼š**/api/socratic
```

### 4. è¿è¡Œæµ‹è¯•

```bash
# UIæ¨¡å¼ï¼ˆæ¨èï¼‰
npx playwright test tests/e2e/critical-paths/ai-error-handling.spec.ts --ui

# è°ƒè¯•æ¨¡å¼
npx playwright test tests/e2e/critical-paths/ai-error-handling.spec.ts --debug

# è¿è¡Œå•ä¸ªæµ‹è¯•
npx playwright test -g "AIè°ƒç”¨è¶…æ—¶æ—¶æ˜¾ç¤ºå‹å¥½æç¤º"
```

### 5. è°ƒè¯•å¸¸è§é—®é¢˜

#### é—®é¢˜1ï¼šMockä¸ç”Ÿæ•ˆ
```
Error: æœŸæœ›æ˜¾ç¤ºé”™è¯¯æç¤ºï¼Œä½†å®é™…è°ƒç”¨äº†çœŸå®API
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥è·¯ç”±åŒ¹é…æ˜¯å¦æ­£ç¡®
2. ä½¿ç”¨ `--headed` æ¨¡å¼ï¼Œæ‰“å¼€DevToolsæŸ¥çœ‹Networké¢æ¿
3. ç¡®è®¤æ‹¦æˆªè·¯å¾„ä¸å®é™…APIè·¯å¾„ä¸€è‡´

#### é—®é¢˜2ï¼šé”™è¯¯æç¤ºå…ƒç´ æ‰¾ä¸åˆ°
```
Error: locator('[data-testid="error-message"]') not found
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥å®é™…çš„é”™è¯¯æç¤ºUIæ˜¯ä»€ä¹ˆ
2. å¯èƒ½æ˜¯ `<div class="error">` æˆ–å…¶ä»–
3. è°ƒæ•´é€‰æ‹©å™¨ï¼š`page.locator('.error')`

#### é—®é¢˜3ï¼šæµ‹è¯•é€»è¾‘éœ€è¦è°ƒæ•´

å¾ˆå¤šæµ‹è¯•å‡è®¾äº†ç‰¹å®šçš„é”™è¯¯å¤„ç†é€»è¾‘ï¼Œä¾‹å¦‚ï¼š
- é‡è¯•æŒ‰é’®
- ç†”æ–­å™¨
- é™çº§å†…å®¹

**å¦‚æœå®é™…äº§å“è¿˜æ²¡å®ç°è¿™äº›åŠŸèƒ½**ï¼š
- æ ‡è®°ä¸º `test.skip()` æš‚æ—¶è·³è¿‡
- æˆ–è€…ä¿®æ”¹æµ‹è¯•éªŒè¯å½“å‰çš„è¡Œä¸º

### 6. éªŒæ”¶æ ‡å‡†

âœ… **é€šè¿‡æ ‡å‡†**ï¼š
- è‡³å°‘é€šè¿‡50%çš„æµ‹è¯•ï¼ˆæ ¸å¿ƒçš„é”™è¯¯å¤„ç†åœºæ™¯ï¼‰
- AIæœåŠ¡å¤±è´¥æ—¶ï¼Œç”¨æˆ·ä¸ä¼šçœ‹åˆ°ç™½å±æˆ–500é”™è¯¯
- å…³é”®åœºæ™¯æœ‰å‹å¥½çš„é”™è¯¯æç¤º

ğŸ“ **è®°å½•æœªé€šè¿‡çš„æµ‹è¯•**ï¼š
- å¦‚æœæŸäº›æµ‹è¯•å¤±è´¥æ˜¯å› ä¸ºåŠŸèƒ½æœªå®ç°ï¼Œè®°å½•ä¸‹æ¥
- è¿™äº›å°±æ˜¯ä¸Šçº¿å‰å¿…é¡»è¡¥å……çš„é”™è¯¯å¤„ç†é€»è¾‘

---

## ä¸¤ä¸ªäººçš„åä½œç‚¹

### 1. å…±äº«æµ‹è¯•é…ç½®

å¦‚æœå‘ç°æœ‰å…±åŒçš„é…ç½®éœ€æ±‚ï¼ˆå¦‚ç™»å½•ã€æ•°æ®åˆå§‹åŒ–ï¼‰ï¼Œå¯ä»¥åˆ›å»ºï¼š

```typescript
// tests/e2e/helpers/setup.ts
export async function loginAsTeacher(page) {
  // ç™»å½•é€»è¾‘
}

export async function createTestCase(page) {
  // åˆ›å»ºæµ‹è¯•æ¡ˆä¾‹
}
```

### 2. å¹¶è¡Œè¿è¡Œ

ä¸¤ä¸ªäººçš„æµ‹è¯•å¯ä»¥åŒæ—¶è¿è¡Œï¼Œäº’ä¸å½±å“ï¼š

```bash
# ç»ˆç«¯1ï¼ˆå¼€å‘è€…Aï¼‰
npx playwright test four-acts-flow.spec.ts

# ç»ˆç«¯2ï¼ˆå¼€å‘è€…Bï¼‰
npx playwright test ai-error-handling.spec.ts
```

### 3. é—®é¢˜æ²Ÿé€š

å¦‚æœé‡åˆ°å…±åŒçš„é—®é¢˜ï¼ˆå¦‚æµ‹è¯•ç¯å¢ƒé…ç½®ã€API Mockç­–ç•¥ï¼‰ï¼ŒåŠæ—¶æ²Ÿé€šã€‚

---

## é¢„è®¡æ—¶é—´å®‰æ’

### Day 1
- **å¼€å‘è€…A**ï¼šå‡†å¤‡æµ‹è¯•æ•°æ®ï¼Œè°ƒæ•´é€‰æ‹©å™¨ï¼Œè¿è¡Œç¬¬ä¸€å¹•å’Œç¬¬äºŒå¹•æµ‹è¯•
- **å¼€å‘è€…B**ï¼šç†è§£Mockæœºåˆ¶ï¼Œè°ƒæ•´APIæ‹¦æˆªè·¯å¾„ï¼Œè¿è¡Œè¶…æ—¶å’Œé”™è¯¯æµ‹è¯•

### Day 2
- **å¼€å‘è€…A**ï¼šè¿è¡Œç¬¬ä¸‰å¹•å’Œç¬¬å››å¹•æµ‹è¯•ï¼Œå¤„ç†å¤±è´¥case
- **å¼€å‘è€…B**ï¼šè¿è¡Œç½‘ç»œæ–­å¼€ã€ç©ºç»“æœã€ç†”æ–­å™¨æµ‹è¯•

### Day 3
- **å¼€å‘è€…A**ï¼šä¼˜åŒ–æµ‹è¯•ç¨³å®šæ€§ï¼Œè¡¥å……è¾¹ç•Œcase
- **å¼€å‘è€…B**ï¼šè¡¥å……é™çº§é€»è¾‘æµ‹è¯•ï¼Œé”™è¯¯è¾¹ç•Œæµ‹è¯•
- **ä¸¤äºº**ï¼šä»£ç reviewï¼Œæ•´ç†æµ‹è¯•æŠ¥å‘Š

---

## æœ€ç»ˆäº¤ä»˜ç‰©

1. **æµ‹è¯•ä»£ç **ï¼š
   - `four-acts-flow.spec.ts` å…¨éƒ¨é€šè¿‡
   - `ai-error-handling.spec.ts` è‡³å°‘50%é€šè¿‡

2. **æµ‹è¯•æŠ¥å‘Š**ï¼š
   ```bash
   # ç”ŸæˆHTMLæŠ¥å‘Š
   npx playwright show-report
   ```

3. **é—®é¢˜æ¸…å•**ï¼š
   - å“ªäº›æµ‹è¯•å¤±è´¥äº†ï¼Ÿ
   - å¤±è´¥åŸå› æ˜¯åŠŸèƒ½ç¼ºå¤±è¿˜æ˜¯æµ‹è¯•é—®é¢˜ï¼Ÿ
   - éœ€è¦è¡¥å……å“ªäº›é”™è¯¯å¤„ç†é€»è¾‘ï¼Ÿ

4. **æµ‹è¯•æ•°æ®**ï¼š
   - `tests/fixtures/test-judgment.docx` æäº¤åˆ°ä»“åº“
   - æ·»åŠ  `.gitignore` è§„åˆ™ï¼ˆå¦‚æœæ–‡æ¡£å¤ªå¤§ï¼‰

---

## å¸¸è§å‘½ä»¤é€ŸæŸ¥

```bash
# è¿è¡Œæ‰€æœ‰E2Eæµ‹è¯•
npm run test:e2e

# è¿è¡Œç‰¹å®šæ–‡ä»¶
npx playwright test four-acts-flow.spec.ts

# UIæ¨¡å¼ï¼ˆæœ€å¥½ç”¨ï¼‰
npx playwright test --ui

# è°ƒè¯•æ¨¡å¼
npx playwright test --debug

# åªè¿è¡Œå¤±è´¥çš„æµ‹è¯•
npx playwright test --last-failed

# ç”Ÿæˆä»£ç ï¼ˆè‡ªåŠ¨å½•åˆ¶æ“ä½œï¼‰
npx playwright codegen http://localhost:3000
```

---

## éœ€è¦å¸®åŠ©ï¼Ÿ

1. æŸ¥çœ‹Playwrightå®˜æ–¹æ–‡æ¡£ï¼šhttps://playwright.dev/
2. æŸ¥çœ‹é¡¹ç›®çš„ `playwright.config.ts` é…ç½®
3. è”ç³»Seanæˆ–æŠ€æœ¯è´Ÿè´£äºº

**è®°ä½Seançš„åŸåˆ™**ï¼š
- âœ… ç®€æ´çš„é€šè¿‡æ–¹æ¡ˆ > å¤æ‚çš„å®Œç¾æ–¹æ¡ˆ
- âœ… å…ˆè®©æ ¸å¿ƒè·¯å¾„é€šè¿‡ï¼Œå†è¡¥å……è¾¹ç•Œcase
- âœ… æµ‹è¯•å¤±è´¥ä¸å¯æ€•ï¼Œæ‰¾åˆ°é—®é¢˜å°±æ˜¯ä»·å€¼
